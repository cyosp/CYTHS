#!/bin/bash

if [ ! -r /dev/ttyAMA0 ]; then
    echo "Serial port not found => wait forever"
    sleep infinity
fi

# Wait a new RSL code
while read LINE
do
	# Get received date <=> date when there is a new line
	RECEIVED_DATE=$(date "+%Y-%m-%dT%H:%M:%S")

	# Remove carriage return
	CODE=`echo $LINE | tr -d $'\r'`

	cyths-update "$CODE" "$RECEIVED_DATE"

done < <(cat /dev/ttyAMA0)
#done < <((stty 115200 cs8 -ixon; cat) < /dev/ttyACM0)

